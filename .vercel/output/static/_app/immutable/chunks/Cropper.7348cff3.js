import{S as pt,i as xt,s as Et,k as X,a as Mt,l as B,m as at,c as At,h as b,n as w,Q as z,p as E,b as ht,E as $,X as D,Y as S,F as tt,Z as Dt,a1 as Zt,o as Ct,ab as Lt,ac as bt,a8 as L,w as et}from"./index.0a5d0d14.js";function nt(o,t,n){return o>=t*n?{width:t*n,height:t}:{width:o,height:o/n}}function Y(o,t,n,r){return{x:ot(o.x,t.width,n.width,r),y:ot(o.y,t.height,n.height,r)}}function ot(o,t,n,r){const s=t*r/2-n/2;return Math.min(s,Math.max(o,-s))}function it(o,t){return Math.sqrt(Math.pow(o.y-t.y,2)+Math.pow(o.x-t.x,2))}function kt(o,t,n,r,s,c=!0){const l=c?It:Tt,i={x:l(100,((t.width-n.width/s)/2-o.x/s)/t.width*100),y:l(100,((t.height-n.height/s)/2-o.y/s)/t.height*100),width:l(100,n.width/t.width*100/s),height:l(100,n.height/t.height*100/s)},h=l(t.naturalWidth,i.width*t.naturalWidth/100,!0),a=l(t.naturalHeight,i.height*t.naturalHeight/100,!0),_=t.naturalWidth>=t.naturalHeight*r?{width:Math.round(a*r),height:a}:{width:h,height:Math.round(h/r)},M={..._,x:l(t.naturalWidth-_.width,i.x*t.naturalWidth/100,!0),y:l(t.naturalHeight-_.height,i.y*t.naturalHeight/100,!0)};return{croppedAreaPercentages:i,croppedAreaPixels:M}}function It(o,t,n=!1){const r=n?Math.round(t):t;return Math.min(o,Math.max(0,r))}function Tt(o,t){return t}function rt(o,t){return{x:(t.x+o.x)/2,y:(t.y+o.y)/2}}const{window:Wt}=bt;function st(o){let t;return{c(){t=X("div"),this.h()},l(n){t=B(n,"DIV",{class:!0,style:!0,"data-testid":!0}),at(t).forEach(b),this.h()},h(){w(t,"class","cropperArea svelte-12kodkg"),E(t,"width",o[7].width+"px"),E(t,"height",o[7].height+"px"),w(t,"data-testid","cropper"),L(t,"round",o[3]==="round"),L(t,"grid",o[4])},m(n,r){ht(n,t,r)},p(n,r){r[0]&128&&E(t,"width",n[7].width+"px"),r[0]&128&&E(t,"height",n[7].height+"px"),r[0]&8&&L(t,"round",n[3]==="round"),r[0]&16&&L(t,"grid",n[4])},d(n){n&&b(t)}}}function Ht(o){let t,n,r,s,c,l,i=o[7]&&st(o);return{c(){t=X("div"),n=X("img"),s=Mt(),i&&i.c(),this.h()},l(h){t=B(h,"DIV",{class:!0,"data-testid":!0});var a=at(t);n=B(a,"IMG",{class:!0,src:!0,alt:!0,style:!0,crossorigin:!0}),s=At(a),i&&i.l(a),a.forEach(b),this.h()},h(){w(n,"class","image svelte-12kodkg"),z(n.src,r=o[2])||w(n,"src",r),w(n,"alt",""),E(n,"transform","translate("+o[1].x+"px, "+o[1].y+"px) scale("+o[0]+")"),w(n,"crossorigin",o[5]),w(t,"class","container svelte-12kodkg"),w(t,"data-testid","container")},m(h,a){ht(h,t,a),$(t,n),o[20](n),$(t,s),i&&i.m(t,null),o[21](t),c||(l=[D(Wt,"resize",o[10]),D(n,"load",o[9]),D(t,"mousedown",S(o[11])),D(t,"touchstart",S(o[12])),D(t,"wheel",S(o[13]))],c=!0)},p(h,a){a[0]&4&&!z(n.src,r=h[2])&&w(n,"src",r),a[0]&3&&E(n,"transform","translate("+h[1].x+"px, "+h[1].y+"px) scale("+h[0]+")"),a[0]&32&&w(n,"crossorigin",h[5]),h[7]?i?i.p(h,a):(i=st(h),i.c(),i.m(t,null)):i&&(i.d(1),i=null)},i:tt,o:tt,d(h){h&&b(t),o[20](null),i&&i.d(),o[21](null),c=!1,Dt(l)}}}function qt(o,t,n){let{image:r}=t,{crop:s={x:0,y:0}}=t,{zoom:c=1}=t,{aspect:l=4/3}=t,{minZoom:i=1}=t,{maxZoom:h=3}=t,{cropSize:a=null}=t,{cropShape:k="rect"}=t,{showGrid:_=!0}=t,{zoomSpeed:M=1}=t,{crossOrigin:R=null}=t,{restrictPosition:P=!0}=t,f=null,A={width:0,height:0,naturalWidth:0,naturalHeight:0},g=null,p=null,d=null,I={x:0,y:0},T={x:0,y:0},W=0,H=null,q=null;const ct=Zt();Ct(()=>{d&&d.complete&&Q(),g&&(g.addEventListener("gesturestart",Z),g.addEventListener("gesturechange",Z))}),Lt(()=>{g&&(g.removeEventListener("gesturestart",Z),g.removeEventListener("gesturechange",Z)),V()});const Z=e=>e.preventDefault(),V=()=>{typeof document<"u"&&(document.removeEventListener("mousemove",J),document.removeEventListener("mouseup",C),document.removeEventListener("touchmove",K),document.removeEventListener("touchend",C))},Q=()=>{j(),N()},ut=()=>a?a.width/a.height:l,j=()=>{d&&(A={width:d.width,height:d.height,naturalWidth:d.naturalWidth,naturalHeight:d.naturalHeight},n(7,f=a||nt(d.width,d.height,l))),g&&(p=g.getBoundingClientRect())},O=e=>({x:Number(e.clientX),y:Number(e.clientY)}),x=e=>({x:Number(e.clientX),y:Number(e.clientY)}),lt=e=>{document.addEventListener("mousemove",J),document.addEventListener("mouseup",C),F(O(e))},J=e=>G(O(e)),dt=e=>{document.addEventListener("touchmove",K,{passive:!1}),document.addEventListener("touchend",C),e.touches.length===2?mt(e):e.touches.length===1&&F(x(e.touches[0]))},K=e=>{e.preventDefault(),e.touches.length===2?ft(e):e.touches.length===1&&G(x(e.touches[0]))},F=({x:e,y:u})=>{I={x:e,y:u},T={x:s.x,y:s.y}},G=({x:e,y:u})=>{H&&window.cancelAnimationFrame(H),H=window.requestAnimationFrame(()=>{if(e===void 0||u===void 0||!f)return;const m=e-I.x,v=u-I.y,y={x:T.x+m,y:T.y+v};n(1,s=P?Y(y,A,f,c):y)})},C=()=>{V(),N()},mt=e=>{const u=x(e.touches[0]),m=x(e.touches[1]);W=it(u,m),F(rt(u,m))},ft=e=>{const u=x(e.touches[0]),m=x(e.touches[1]),v=rt(u,m);G(v),q&&window.cancelAnimationFrame(q),q=window.requestAnimationFrame(()=>{const y=it(u,m),Pt=c*(y/W);U(Pt,v),W=y})},gt=e=>{const u=O(e),m=c-e.deltaY*M/200;U(m,u)},wt=({x:e,y:u})=>{if(!p)throw new Error("The Cropper is not mounted");return{x:p.width/2-(e-p.left),y:p.height/2-(u-p.top)}},yt=({x:e,y:u})=>({x:(e+s.x)/c,y:(u+s.y)/c}),U=(e,u)=>{if(!f)return;const m=wt(u),v=yt(m);n(0,c=Math.min(h,Math.max(e,i)));const y={x:v.x*c-m.x,y:v.y*c-m.y};n(1,s=P?Y(y,A,f,c):y)},N=()=>{if(!f||f.width===0)return;const e=P?Y(s,A,f,c):s,{croppedAreaPercentages:u,croppedAreaPixels:m}=kt(e,A,f,ut(),c,P);ct("cropcomplete",{percent:u,pixels:m})};function vt(e){et[e?"unshift":"push"](()=>{d=e,n(6,d)})}function _t(e){et[e?"unshift":"push"](()=>{g=e,n(8,g)})}return o.$$set=e=>{"image"in e&&n(2,r=e.image),"crop"in e&&n(1,s=e.crop),"zoom"in e&&n(0,c=e.zoom),"aspect"in e&&n(14,l=e.aspect),"minZoom"in e&&n(15,i=e.minZoom),"maxZoom"in e&&n(16,h=e.maxZoom),"cropSize"in e&&n(17,a=e.cropSize),"cropShape"in e&&n(3,k=e.cropShape),"showGrid"in e&&n(4,_=e.showGrid),"zoomSpeed"in e&&n(18,M=e.zoomSpeed),"crossOrigin"in e&&n(5,R=e.crossOrigin),"restrictPosition"in e&&n(19,P=e.restrictPosition)},o.$$.update=()=>{o.$$.dirty[0]&147520&&d&&n(7,f=a||nt(d.width,d.height,l)),o.$$.dirty[0]&1&&c&&N()},[c,s,r,k,_,R,d,f,g,Q,j,lt,dt,gt,l,i,h,a,M,P,vt,_t]}class Ft extends pt{constructor(t){super(),xt(this,t,qt,Ht,Et,{image:2,crop:1,zoom:0,aspect:14,minZoom:15,maxZoom:16,cropSize:17,cropShape:3,showGrid:4,zoomSpeed:18,crossOrigin:5,restrictPosition:19},null,[-1,-1])}}export{Ft as C};
